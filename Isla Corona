
DECLARE @Fecha1 DATE = '2025-08-16';
DECLARE @Fecha2 DATE = '20250816';

SELECT 1002 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,motivo NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1002 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION 

SELECT 1003 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1003 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION  

SELECT 1001 COD,'Isla' CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,'' NAC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1001 AND DBCR = 'D'

/** RESTAURANTE PASADIA  **/

select  1001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA > 0  AND C.CODCAJA = 'PD'


UNION

select  1001 COD,39 CIA, PS.FECHA,PS.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,CONVERT(int,PS.DESCUENTO)/2 * -1 VALOR,
9999 HAB,CONVERT(VARCHAR(10), NFOLIO)  RECIBO,CUENTA TRX_NO,CUENTA FACTURA,'DESC PASADIA ALIMENTOS' REFERENCIA, 'A' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,PS.DESCUENTO)/2 * -1  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_cuentas  PS
WHERE PS.fecha = @Fecha2 AND PS.DESCUENTO <> '0'


UNION 
 
select  1001 COD,39 CIA, PS.FECHA,PS.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,CONVERT(int,PS.DESCUENTO)/2 * -1 VALOR,
9999 HAB,CONVERT(VARCHAR(10), NFOLIO)  RECIBO,CUENTA TRX_NO,CUENTA FACTURA,'DESC PASADIA BEBIDAS' REFERENCIA, 'B' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'PASADIA' TIPO_DOC,CONVERT(int,PS.DESCUENTO)/2 * -1  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_cuentas  PS
WHERE PS.fecha = @Fecha2 AND PS.DESCUENTO <> '0'

UNION 


/** ALIMENTOS Y BEBDIDAS **/
/** ESTA ES LA CONSULTA PARA RESTAURANTE  **/

select  5001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
AND  C.CODCAJA = 'REST' AND C.PLAZA <>'ATE'

/** ESTA ES LA CONSULTA PARA PL CHIRINGUITO   **/

UNION 


DECLARE @Fecha2 DATE = '20250817';
select  5002 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'PL'  AND C.PLAZA <>'ATE'

UNION 


 /** ESTA ES LA CONSULTA PARA PL PARCHADERO  SC   **/

select  5002 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,'' NAC,C.VVENTA VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'SC'  AND C.PLAZA <>'ATE'

UNION 

	--IPC
	SELECT 8 COD,39 CIA,U.FECHA,U.cuenta RESERV,1 TIP,'333333333' TERCERO,
    '001' SUC,'' NAC,CONVERT(int,U.SERVICIO) VALOR,9999 HAB,U.CODIGO_EVE RECIBO,U.CUENTA TRX_NO,
    U.FACTURA FACTURA,U.MOTIVO REFERENCIA,U.MOTIVO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,U.FECHA FECHA_DE_VENC,'' FACT_ASOC,
    '' TIPO_DOC,U.SERVICIO/2 VALOR_ME,'' DISPLAY_NAME,U.TITULAR NOMBRE,
    (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) address1,
    (SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) city,
    (SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) country,
    U.TELEFONO phone_no FROM   Ps_Cuentas U 
WHERE U.fecha = @Fecha2 AND U.SERVICIO <> 0

UNION 

 	--IVA
 select  1100 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(int,( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 from Movfolio  M WHERE M.fecha=@Fecha1 and M.CCARGO_CAR= 1100

UNION

 	--INGRESO PARA TERCEROS TRANSPORTE
 select  1109 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(int,( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 from Movfolio  M WHERE M.fecha=@Fecha1 and M.CCARGO_CAR= 1109

UNION
 	--PROPINA

SELECT 54 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.propinapagada)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and propinapagada <> 0  and PLAZA = ' '

UNION 
--EFECTIVO-CAJA GENERAL
 select  9000 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha = @Fecha1 AND FPAGO ='E' AND TRANSFERID = 'P'

UNION 
--VISA 9004

  select  9004 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
'' NAC, valor  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND PLAZA = 'VIS' and DBCR <> 'D' AND TRANSFERID = 'P'

 UNION 

 --CREDITO VISA POS REVISAR CODIGO DIFERENTE
SELECT 9004  COD,39 CIA,C.FECHA,C.CUENTA RESERV,1 TIP,'333333333' TERCERO,'001' SUC,'' NAC,CONVERT(int,C.VVENTA*-1) VALOR,
9999 HAB,C.TIQUETE RECIBO,C.CONSUID TRX_NO,C.tiquete FACTURA,P.descripcion REFERENCIA,A.TIPOPROD NOTAS,'' NRO_TARJETA,
'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,C.VVENTA VALOR_ME,'' DISPLAY_NAME,'' NOMBRE,'' address1,
'' city,'' country,'' phone_no
FROM ps_consumos C
LEFT JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
LEFT JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
LEFT JOIN  Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND CODFPGO = 'TCV'








