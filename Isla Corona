
DECLARE @Fecha1 DATE = '2025-10-10';
DECLARE @Fecha2 DATE = '20251010';

SELECT 1002 COD,39 CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,motivo NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1002 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION 


SELECT 1003 COD,39 CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1003 
AND ( m.plaza = '0' OR m.plaza IS NULL)

UNION  


SELECT 1001 COD,39 CIA,fecha,M.nfolio RESERV, 1 TIP,A.ident_cli TERCERO,'001' SUC,
CONVERT(int,(CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ))  VALOR,
CASE WHEN ISNUMERIC(M.nrohab_hab) = 1 THEN CONVERT(varchar(10), M.nrohab_hab) ELSE '9999' END HAB,
CASE  WHEN ISNUMERIC(recibocaj) = 1 THEN CONVERT(VARCHAR(10), recibocaj)ELSE NULL END RECIBO,
nroregis TRX_NO,factura FACTURA,descri_car REFERENCIA,DBCR NOTAS,M.tcre NRO_TARJETA,M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,tasachin_us VALOR_ME,(SELECT Max(nombre_cli) 
FROM clientes C WHERE  C.ident_cli = A.ident_cli) DISPLAY_NAME,'' NOMBRE,
(SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) address1,
(SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) city,
(SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) country,
(SELECT Max(telef_cli) FROM Clientes C WHERE  C.ident_cli = A.ident_cli) phone_no
FROM Movfolio M,Cargos C,Maefolio A
WHERE M.ccargo_car = C.ccargo_car AND M.nfolio = A.nfolio AND fecha = @Fecha1 AND  M.ccargo_car = 1001 AND DBCR = 'D'




UNION

--
select  5001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,CONVERT(int,C.VVENTA) VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'RESTAURANTE ALIMENTOS' REFERENCIA, A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
from ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
where C.fecha = @Fecha2 AND TRANSFERID IS NULL AND C.VVENTA <> 0 and C.plaza NOT IN  ('ATE','FOL') AND  A.TIPOPROD = 'A'

UNION 

--RESTAURANTE BEBIDAS(PLAYA)
select  5001 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,CONVERT(int,C.VVENTA) VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'RESTAURANTE BEBIDAS(PLAYA)' REFERENCIA, A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no 
from ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
where C.fecha = @Fecha2 AND TRANSFERID IS NULL AND C.VVENTA <> 0 and C.plaza NOT IN ('ATE','FOL') AND  A.TIPOPROD = 'B'



UNION 


select  5002 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC,  CONVERT(int,C.VVENTA) VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'REST' REFERENCIA, P.CODCENTRO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'PL'  AND C.PLAZA <>'ATE'

UNION 


 /** ESTA ES LA CONSULTA PARA PL PARCHADERO  SC   **/
 --PARCHADERO (SUNCLUB) ALIMENTOS
select  5003 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC, CONVERT(int,C.VVENTA) VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PARCHADERO (SUNCLUB) ALIMENTOS' REFERENCIA,  A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'SC'  AND C.PLAZA <>'ATE'  AND  A.TIPOPROD = 'A'

 UNION
 --PARCHADERO (SUNCLUB) BEBIDAS
 select  5003 COD,39 CIA, C.FECHA,C.cuenta RESERV,1 TIP,'333333333' TRECERO,'001' SUC, CONVERT(int,C.VVENTA) VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PARCHADERO (SUNCLUB) BEBIDAS' REFERENCIA,  A.TIPOPROD NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'REST' TIPO_DOC,CONVERT(int,C.VVENTA)  VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
  FROM ps_consumos C
INNER JOIN ps_cuentas Q ON c.FECHA = Q.FECHA AND C.CODCAJA = Q.CODCAJA AND C.CUENTA = Q.CUENTA
INNER JOIN Ps_producto P ON C.CODPRODUCTO = P.CODPRODUCTO
INNER JOIN Ps_Agrupa A ON A.CODAGRUPA = P.CODAGRUPA
WHERE C.fecha = @Fecha2 AND C.TRANSFERID IS NULL AND C.VVENTA <> 0 
 AND  C.CODCAJA = 'SC'  AND C.PLAZA <>'ATE'  AND  A.TIPOPROD = 'B'

 UNION
 
 ---MISCELANEOS GRAVADOS
select  1105 COD , 41 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, (CASE WHEN dbcr = 'C' THEN -1 ELSE 1 END * valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND CCARGO_CAR = 1105


  ---SERVICIO DE SPA

  UNION

select  3001 COD , 41 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, (CASE WHEN dbcr = 'C' THEN -1 ELSE 1 END * valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND CCARGO_CAR = 3001


 UNION
--PARQUES NATURALES
select  1113 COD , 41 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, (CASE WHEN dbcr = 'C' THEN -1 ELSE 1 END * valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND CCARGO_CAR = 1113

 UNION
 	--PROPINA
SELECT 54 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,C.propinapagada)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and propinapagada <> 0  and PLAZA = ' '

UNION

 	--INGRESO PARA TERCEROS TRANSPORTE
 select  1109 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(int,( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 from Movfolio  M WHERE M.fecha=@Fecha1 and M.CCARGO_CAR= 1109

 UNION 
 	--IVA

 select  1100 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,CONVERT(int,( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 from Movfolio  M WHERE M.fecha=@Fecha1 and M.CCARGO_CAR= 1100

UNION 

	-- IMPC 
	SELECT 8 COD,39 CIA,U.FECHA,U.cuenta RESERV,1 TIP,'333333333' TERCERO,
    '001' SUC,CONVERT(int,U.SERVICIO) VALOR,9999 HAB,U.CODIGO_EVE RECIBO,U.CUENTA TRX_NO,
    U.FACTURA FACTURA,U.MOTIVO REFERENCIA,U.MOTIVO NOTAS,'' NRO_TARJETA,'' AUTORIZACION,U.FECHA FECHA_DE_VENC,'' FACT_ASOC,
    '' TIPO_DOC,U.SERVICIO/2 VALOR_ME,'' DISPLAY_NAME,U.TITULAR NOMBRE,
    (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) address1,
    (SELECT Max(codciud) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) city,
    (SELECT Max(codpais) FROM Clientes C WHERE  C.ident_cli = U.CEDULA) country,
    U.TELEFONO phone_no FROM   Ps_Cuentas U 
WHERE U.fecha = @Fecha2 AND U.SERVICIO <> 0


UNION 

--1061

 select  '1061' COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,
 CONVERT(int,( CASE WHEN dbcr = 'C' THEN 1 ELSE -1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no
 from Movfolio  M WHERE M.fecha = convert(smalldatetime,@Fecha1,120) and M.CCARGO_CAR= 1112


UNION 

--EFECTIVO-CAJA GENERAL
 SELECT 9000 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,C.VVENTA*-1)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and CODFPGO = 'EFE'


UNION 


--FORMA DE PAGO TARJETA DE CREDITO VISA POS
 SELECT 9004 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and C.CODFPGO = 'TCV' 
 
 UNION 

--FORMA DE PAGO TARJETA DE DEBITO VISA POS
 SELECT 9004 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  AND C.CODFPGO = 'TDV'

UNION

--FORMA DE PAGO VISA 9004
  select  9004 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(int, M.valor ) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND PLAZA = 'VIS'




UNION




--FORMA DE PAGO TARJETA DE CREDITO MASTER POS
 SELECT 9005 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and C.CODFPGO = 'TCM' 
 
 UNION 

--FORMA DE PAGO TARJETA DE DEBITO MASTER POS
 SELECT 9005 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  AND C.CODFPGO = 'TDM'
-- Hola
UNION
  --MASTER
    select  9005 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND PLAZA = 'MTC'

UNION



 --POS AMERICAN EXPRESS FRONT
select  9003 COD , 39 CIA,M.FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(INT,valor) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, 12344 FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND PLAZA = 'AMX'



 UNION

  SELECT 9003 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  and C.CODFPGO = 'TCA' 
 
 UNION 

--FORMA DE PAGO TARJETA DE DEBITO MASTER POS
 SELECT 9003 COD,39 CIA,fecha,C.cuenta RESERV,1 TIP,'333333333' TERCERO,'001' SUC,CONVERT(int,-1 * C.VVENTA)    VALOR,
9999 HAB,CONVERT(VARCHAR(10), tiquete)  RECIBO,consuid TRX_NO,tiquete FACTURA,'PROPINA POS' REFERENCIA, 
C.codcentro + '-' + ' PROPINA' NOTAS,'' NRO_TARJETA,'' AUTORIZACION,NULL FECHA_DE_VENC,'' FACT_ASOC,'POS' TIPO_DOC,0 VALOR_ME,
'' DISPLAY_NAME,'' NOMBRE,'' address1,'' city,''country,'' phone_no
FROM ps_consumos C  WHERE fecha = @Fecha2  AND C.CODFPGO = 'TDA'


UNION

 --CONSIGNACIONES-CTA AHORROS


select  9007 COD , 39 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, 
  CONVERT(int,( CASE WHEN dbcr = 'D' THEN -1 ELSE 1 END * valor )) VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC, CONVERT(int, -1 * valor)  VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'R'  and TRANSFERID= 'p'


UNION

 --CREDITO COMPAÑÍA-CXC
 
select  9110 COD , 39 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN -1 ELSE 1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'V'

 UNION
  
 select  9110 COD , 39 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC, CONVERT(INT,valor)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.MOTIVO NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN -1 ELSE 1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha =@Fecha1 AND FPAGO = 'D'


UNION


 select  1010 COD , 39 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,  CONVERT(int,( CASE WHEN dbcr = 'C' THEN 1 ELSE -1 END * valor ))  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.DBCR NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'C' THEN -1 ELSE 1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha = @Fecha1 AND CCARGO_CAR = 1010
 
UNION

 --DEPOSITOS APLICADOS
 select  1011 COD , 39 CIA,CONVERT(VARCHAR(10), M.FECHA, 103) AS FECHA,  M.nfolio RESERV, 1 TIP, M.IDENT_CLI TERCERO, '001' SUC,  CONVERT(int,valor * -1)  VALOR,'9999' HAB,CONVERT(VARCHAR(10), recibocaj) RECIBO, 
nroregis TRX_NO, M.VOUCHE FACTURA, M.MOTIVO REFERENCIA, M.DBCR NOTAS,M.tcre NRO_TARJETA, M.autor AUTORIZACION,
M.vcto FECHA_DE_VENC,'' FACT_ASOC,'' TIPO_DOC,  ( CASE WHEN dbcr = 'D' THEN 1 ELSE -1 END * valor ) VALORME,
(SELECT Max(nombre_cli) FROM Clientes C WHERE  C.IDENT_CLI = M.IDENT_CLI) DISPLAY_NAME, '' NOMBRE,
 (SELECT Max(direcc_cli) FROM Clientes C WHERE  C.ident_cli = M.ident_cli) address1,
 (SELECT Max(codciud)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) city,
 (SELECT Max(codpais)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) country,
 (SELECT Max(telef_cli)FROM Clientes C WHERE  C.ident_cli = M.ident_cli) phone_no 
 FROM movfolio M WHERE fecha = @Fecha1 AND CCARGO_CAR = 1010 and DBCR = 'D'